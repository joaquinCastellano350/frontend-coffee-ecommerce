<div class="admin-stats-page">
  <div class="dashboard-header">
    <div>
      <h1>Admin Dashboard</h1>
      <p class="subtitle">Panel de gesti√≥n del negocio</p>
    </div>

    <div class="user-chip" *ngIf="auth.user()">
      <mat-icon class="user-icon">account_circle</mat-icon>
      <div>
        <span class="user-name">{{ auth.user()!.email }}</span>
        <span class="user-role">Administrador</span>
      </div>
    </div>
  </div>

  <div class="summary-grid">
    <mat-card class="summary-card">
      <div class="summary-icon trend">
        <mat-icon>support_agent</mat-icon>
      </div>
      <div class="summary-copy">
        <p class="summary-label">Consultas esta semana</p>
        <h2>{{ totalForms() }}</h2>
        <span class="summary-hint">Ultimos 7 dias</span>
      </div>
    </mat-card>

    <mat-card class="summary-card">
      <div class="summary-icon products">
        <mat-icon>inventory_2</mat-icon>
      </div>
      <div class="summary-copy">
        <p class="summary-label">Productos activos</p>
        <h2>{{ totalProducts() || 0 }}</h2>
        <span class="summary-hint">Catalogo vigente</span>
      </div>
    </mat-card>

    <mat-card class="summary-card">
      <div class="summary-icon wishlist">
        <mat-icon>favorite_border</mat-icon>
      </div>
      <div class="summary-copy">
        <p class="summary-label">Favoritos totales</p>
        <h2>{{ totalWished() || 0 }}</h2>
        <span class="summary-hint">Usuarios interesados</span>
      </div>
    </mat-card>

    <mat-card class="summary-card">
      <div class="summary-icon catalog">
        <mat-icon>menu_book</mat-icon>
      </div>
      <div class="summary-copy">
        <p class="summary-label">Catalogo publicado</p>
        <h2>{{ activeCatalog() || '--' }}</h2>
        <span class="summary-hint">Estado visible</span>
      </div>
    </mat-card>
  </div>

  <div class="charts-grid">
    <mat-card class="chart-card">
      <div class="card-heading">
        <div>
          <p class="eyebrow">Top 10</p>
          <h3>Consultas por producto</h3>
          <p class="support-text">Basado en formularios recibidos</p>
        </div>
        <mat-icon>bar_chart</mat-icon>
      </div>

      <div class="chart-list" *ngIf="askedProducts()?.length; else noAsked">
        <div
          class="chart-row"
          *ngFor="let product of askedProducts() | slice: 0 : 10; index as idx"
        >
          <span class="chart-rank">{{ idx + 1 }}</span>
          <div class="chart-info">
            <p class="chart-name">{{ product.name || 'Producto sin nombre' }}</p>
          </div>
          <span class="chart-value">
            {{ product.count || 0 }}
            consultas
          </span>
        </div>
      </div>
    </mat-card>
  </div>

  <ng-template #noAsked>
    <div class="empty-state">
      <mat-icon>inventory</mat-icon>
      <p>Todavia no hay consultas registradas.</p>
    </div>
  </ng-template>

  <mat-card class="wishlist-card">
    <div class="card-heading">
      <div>
        <p class="eyebrow">Top 3</p>
        <h3>Productos mas deseados</h3>
        <p class="support-text">Basado en favoritos agregados por los usuarios</p>
      </div>
      <mat-icon>favorite</mat-icon>
    </div>

    <div class="wishlist-grid" *ngIf="wishedProducts()?.length; else noWishlist">
      <div class="wishlist-item" *ngFor="let product of wishedProducts() | slice: 0 : 3">
        <div class="product-thumb">
          <img
            [src]="
              product.imageURL
                ? 'uploads' + product.imageURL
                : 'uploads/uploads/assets/placeholder.png'
            "
            [alt]="product.name || 'Producto'"
            loading="lazy"
          />
        </div>
        <div class="product-data">
          <p class="product-name">{{ product.name || 'Producto sin nombre' }}</p>
          <span class="product-count">
            <mat-icon>favorite</mat-icon>
            {{ product.count || 0 }}
            favoritos
          </span>
        </div>
      </div>
    </div>
  </mat-card>

  <ng-template #noWishlist>
    <div class="empty-state">
      <mat-icon>favorite_border</mat-icon>
      <p>Sin favoritos registrados por ahora.</p>
    </div>
  </ng-template>

  <mat-card class="table-card">
    <div class="card-heading">
      <div>
        <p class="eyebrow">Actividad reciente</p>
        <h3>Ultimas consultas de usuarios</h3>
        <p class="support-text">Detalle de clientes interesados en los ultimos dias</p>
      </div>
      <mat-icon>receipt_long</mat-icon>
    </div>

    <div class="table-wrapper" *ngIf="latestsForms()?.length; else noForms">
      <table mat-table [dataSource]="latestsForms()" class="consultas-table mat-elevation-z1">
        <ng-container matColumnDef="client">
          <th mat-header-cell *matHeaderCellDef>Cliente</th>
          <td mat-cell *matCellDef="let f">{{ f.name }}</td>
        </ng-container>

        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let f">{{ f.email }}</td>
        </ng-container>

        <ng-container matColumnDef="product">
          <th mat-header-cell *matHeaderCellDef>Producto</th>
          <td mat-cell *matCellDef="let f">
            {{ f.interestedProduct?.name || 'Consulta general' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Fecha</th>
          <td mat-cell *matCellDef="let f">{{ f.createdAt | date: 'dd/MM/yyyy' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </mat-card>

  <ng-template #noForms>
    <div class="empty-state">
      <mat-icon>support_agent</mat-icon>
      <p>No se registraron consultas recientemente.</p>
    </div>
  </ng-template>
</div>
